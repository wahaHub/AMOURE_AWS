# Amoure API Testing Suite

## ğŸ¯ æ¦‚è¿°

è¿™æ˜¯Amoureé¡¹ç›®çš„å®Œæ•´APIæµ‹è¯•å¥—ä»¶ï¼ŒåŒ…å«V1å’ŒV2ä¸¤å¥—APIçš„Postmané›†åˆã€ç¯å¢ƒé…ç½®å’Œè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
api-testing/
â”œâ”€â”€ README.md                          # æœ¬æ–‡æ¡£
â”œâ”€â”€ environments/                      # ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ Local-Development.postman_environment.json
â”‚   â””â”€â”€ AWS-Development.postman_environment.json
â”œâ”€â”€ postman/                          # Postmané›†åˆ
â”‚   â”œâ”€â”€ Amoure-V1-API.postman_collection.json
â”‚   â”œâ”€â”€ Amoure-V1-API-Part2.json
â”‚   â”œâ”€â”€ Amoure-V2-API.postman_collection.json
â”‚   â””â”€â”€ Amoure-V2-Core-Features.json
â”œâ”€â”€ test-data/                        # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ users.csv
â”‚   â””â”€â”€ test-scenarios.json
â””â”€â”€ scripts/                          # è‡ªåŠ¨åŒ–è„šæœ¬
    â”œâ”€â”€ run-tests.sh
    â””â”€â”€ health-check.js
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥Postmané›†åˆ

**æ­¥éª¤ï¼š**
1. æ‰“å¼€Postman
2. ç‚¹å‡» **Import** 
3. å¯¼å…¥æ–‡ä»¶ï¼š
   - `environments/Local-Development.postman_environment.json`
   - `environments/AWS-Development.postman_environment.json`
   - `postman/Amoure-V1-API.postman_collection.json`
   - `postman/Amoure-V2-API.postman_collection.json`

### 2. é€‰æ‹©ç¯å¢ƒ

- **æœ¬åœ°æµ‹è¯•**: é€‰æ‹© "Local Development" ç¯å¢ƒ
- **AWSæµ‹è¯•**: é€‰æ‹© "AWS Development" ç¯å¢ƒ

### 3. è¿è¡Œè®¤è¯æµç¨‹

**é‡è¦**: å¿…é¡»å…ˆè¿è¡Œç™»å½•æ¥å£è·å–Tokenï¼Œå†æ‰§è¡Œå…¶ä»–éœ€è¦è®¤è¯çš„æ¥å£

#### V1æµ‹è¯•æµç¨‹ï¼š
1. `ğŸ” Authentication` â†’ `SMS Login`
2. éªŒè¯Tokenå·²è‡ªåŠ¨ä¿å­˜
3. è¿è¡Œå…¶ä»–V1æ¥å£

#### V2æµ‹è¯•æµç¨‹ï¼š
1. `ğŸ” V2 Authentication` â†’ `V2 SMS Login`  
2. éªŒè¯Tokenå·²è‡ªåŠ¨ä¿å­˜
3. è¿è¡Œå…¶ä»–V2æ¥å£

## ğŸ”§ ç¯å¢ƒé…ç½®è¯¦è§£

### å˜é‡è¯´æ˜

| å˜é‡å | æè¿° | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `base_url` | åŸºç¡€URL | `http://localhost:8080` |
| `base_url_v1` | V1 APIåŸºç¡€è·¯å¾„ | `http://localhost:8080/api/app` |
| `base_url_v2` | V2 APIåŸºç¡€è·¯å¾„ | `http://localhost:8080/api/v2` |
| `token` | è®¤è¯Token | è‡ªåŠ¨è®¾ç½® |
| `user_id` | å½“å‰ç”¨æˆ·ID | è‡ªåŠ¨è®¾ç½® |
| `test_mobile` | æµ‹è¯•æ‰‹æœºå· | `13800138000` |
| `test_sms_code` | æµ‹è¯•éªŒè¯ç  | `888888` |
| `target_user_id` | ç›®æ ‡ç”¨æˆ·ID | `2` |

### AWSç¯å¢ƒé…ç½®

éœ€è¦æ›´æ–°ALBåœ°å€ï¼š
1. è·å–ECS ALB DNSåç§°ï¼š
   ```bash
   aws elbv2 describe-load-balancers --query 'LoadBalancers[?contains(LoadBalancerName, `amoure-dev`)].DNSName' --output text --region us-east-1
   ```

2. æ›´æ–°ç¯å¢ƒå˜é‡ä¸­çš„`base_url`

## ğŸ“‹ æµ‹è¯•æ¸…å•

### âœ… V1 APIæµ‹è¯•é¡¹ç›®

#### è®¤è¯æ¨¡å—
- [ ] SMSç™»å½•
- [ ] ç™»å‡º
- [ ] Tokenè‡ªåŠ¨ä¿å­˜å’Œä½¿ç”¨

#### ç”¨æˆ·æ¨¡å—  
- [ ] è·å–ç”¨æˆ·ä¿¡æ¯
- [ ] æ›´æ–°ç”¨æˆ·èµ„æ–™
- [ ] ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢

#### äº¤äº’æ¨¡å—
- [ ] ç‚¹èµç”¨æˆ·
- [ ] è·å–å¿ƒåŠ¨åˆ—è¡¨
- [ ] äº¤äº’å†å²

#### æ–‡ä»¶æ¨¡å—
- [ ] æ–‡ä»¶ä¸Šä¼ åˆ°S3
- [ ] æ–‡ä»¶URLç”Ÿæˆ

### âœ… V2 APIæµ‹è¯•é¡¹ç›®

#### è®¤è¯æ¨¡å—
- [ ] V2å¢å¼ºç™»å½•
- [ ] è®¾å¤‡ä¿¡æ¯è¿½è¸ª

#### ç”¨æˆ·æ¨¡å—
- [ ] ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
- [ ] å¢å¼ºçš„èµ„æ–™ç»“æ„

#### äº¤äº’æ¨¡å—
- [ ] ç»Ÿä¸€äº¤äº’æ¥å£ (like/super_like/pass/block)
- [ ] å¿ƒåŠ¨åˆ—è¡¨ç­›é€‰
- [ ] æ‹‰é»‘åˆ—è¡¨ç®¡ç†
- [ ] åŒ¹é…æ£€æµ‹

#### æ¨èæ¨¡å—
- [ ] æ™ºèƒ½æ¨èåˆ—è¡¨
- [ ] æ¨èç®—æ³•éªŒè¯

#### ä¼šè¯æ¨¡å—
- [ ] å¯¹è¯åˆ—è¡¨
- [ ] IMå¯¹è¯ç®¡ç†

### âœ… åŸºç¡€è®¾æ–½æµ‹è¯•

#### Redis Session
- [ ] Tokenè·¨æœåŠ¡å™¨å…±äº«
- [ ] ä¼šè¯è¿‡æœŸå¤„ç†
- [ ] å¹¶å‘Sessionç®¡ç†

#### S3å­˜å‚¨
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] é¢„ç­¾åURLç”Ÿæˆ
- [ ] æ–‡ä»¶åˆ é™¤åŠŸèƒ½

#### é”™è¯¯å¤„ç†
- [ ] æ— æ•ˆTokenå¤„ç†
- [ ] å‚æ•°éªŒè¯
- [ ] ä¸šåŠ¡é€»è¾‘é”™è¯¯

## ğŸ”¬ é«˜çº§æµ‹è¯•åŠŸèƒ½

### 1. è‡ªåŠ¨Tokenç®¡ç†

æ‰€æœ‰é›†åˆéƒ½åŒ…å«è‡ªåŠ¨Tokenç®¡ç†ï¼š
- **ç™»å½•æ—¶**: è‡ªåŠ¨ä¿å­˜Tokenåˆ°ç¯å¢ƒå˜é‡
- **è¯·æ±‚æ—¶**: è‡ªåŠ¨æ·»åŠ Tokenåˆ°Header
- **è¿‡æœŸæ—¶**: æç¤ºé‡æ–°ç™»å½•

### 2. å“åº”éªŒè¯

æ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«ï¼š
- HTTPçŠ¶æ€ç éªŒè¯
- ä¸šåŠ¡å“åº”ç éªŒè¯  
- æ•°æ®ç»“æ„éªŒè¯
- æ€§èƒ½æŒ‡æ ‡æ£€æŸ¥

### 3. é“¾å¼ä¾èµ–

æµ‹è¯•è¯·æ±‚æŒ‰ä¾èµ–å…³ç³»æ’åºï¼š
- ç™»å½• â†’ è·å–ç”¨æˆ·ä¿¡æ¯ â†’ äº¤äº’æ“ä½œ
- è‡ªåŠ¨ä¼ é€’å¿…è¦å‚æ•°
- å¤±è´¥æ—¶ä¸­æ–­åç»­æµ‹è¯•

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### å†’çƒŸæµ‹è¯•
å¿«é€ŸéªŒè¯æ ¸å¿ƒåŠŸèƒ½ï¼š
1. V1/V2ç™»å½•
2. ç”¨æˆ·ä¿¡æ¯è·å–
3. åŸºç¡€äº¤äº’æ“ä½œ

### åŠŸèƒ½æµ‹è¯•
å®Œæ•´ä¸šåŠ¡æµç¨‹éªŒè¯ï¼š
1. ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹
2. å®Œæ•´ç¤¾äº¤äº¤äº’æµç¨‹
3. æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æµç¨‹

### é›†æˆæµ‹è¯•
è·¨ç‰ˆæœ¬å…¼å®¹æ€§ï¼š
1. V1/V2æ•°æ®ä¸€è‡´æ€§
2. Redis Sessionå…±äº«
3. S3å­˜å‚¨ä¸€è‡´æ€§

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

ä½¿ç”¨Postman CLIè¿è¡Œå¹¶ç”ŸæˆæŠ¥å‘Šï¼š

```bash
# å®‰è£…newman
npm install -g newman

# è¿è¡ŒV1æµ‹è¯•
newman run postman/Amoure-V1-API.postman_collection.json \
  -e environments/Local-Development.postman_environment.json \
  --reporters html,cli \
  --reporter-html-export v1-test-report.html

# è¿è¡ŒV2æµ‹è¯•  
newman run postman/Amoure-V2-API.postman_collection.json \
  -e environments/Local-Development.postman_environment.json \
  --reporters html,cli \
  --reporter-html-export v2-test-report.html
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

### æµ‹è¯•ç¯å¢ƒå‡†å¤‡
1. **æœ¬åœ°æµ‹è¯•**: ç¡®ä¿Spring Bootåº”ç”¨åœ¨localhost:8080è¿è¡Œ
2. **AWSæµ‹è¯•**: ç¡®ä¿ECSæœåŠ¡æ­£å¸¸è¿è¡Œ
3. **æ•°æ®åº“**: ç¡®ä¿æœ‰æµ‹è¯•ç”¨æˆ·æ•°æ®
4. **Redis**: ç¡®ä¿SessionåŠŸèƒ½æ­£å¸¸

### æµ‹è¯•æ•°æ®ç®¡ç†
- ä½¿ç”¨å›ºå®šçš„æµ‹è¯•ç”¨æˆ·ID
- é¿å…æ±¡æŸ“ç”Ÿäº§æ•°æ®
- å®šæœŸæ¸…ç†æµ‹è¯•æ•°æ®

### å®‰å…¨æ³¨æ„
- ä¸è¦åœ¨é›†åˆä¸­ç¡¬ç¼–ç çœŸå®å¯†ç 
- ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- å®šæœŸæ›´æ–°æµ‹è¯•Token

---

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. Tokenæ— æ•ˆ**
- æ£€æŸ¥ç™»å½•æ¥å£æ˜¯å¦æˆåŠŸ
- éªŒè¯Tokenæ ¼å¼å’Œæœ‰æ•ˆæœŸ
- ç¡®è®¤Headeråç§°ä¸º`satoken`

**2. ç¯å¢ƒè¿æ¥å¤±è´¥**
- æ£€æŸ¥base_urlé…ç½®
- éªŒè¯ç½‘ç»œè¿æ¥
- ç¡®è®¤æœåŠ¡è¿è¡ŒçŠ¶æ€

**3. è·¨ç‰ˆæœ¬æ•°æ®ä¸ä¸€è‡´**
- æ£€æŸ¥æ•°æ®åº“è¿æ¥
- éªŒè¯Redisé…ç½®
- ç¡®è®¤V1/V2ä½¿ç”¨ç›¸åŒæ•°æ®æº

---

*æœ€åæ›´æ–°: 2025-09-13*  
*ç»´æŠ¤è€…: Amoureå›¢é˜Ÿ*